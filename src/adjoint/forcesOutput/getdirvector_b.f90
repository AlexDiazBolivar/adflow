!        Generated by TAPENADE     (INRIA, Tropics team)
!  Tapenade 2.2.4 (r2308) - 03/04/2008 10:03
!  
!  Differentiation of getdirvector in reverse (adjoint) mode:
!   gradient, with respect to input variables: alpha beta
!   of linear combination of output variables: zw alpha xw yw beta
!
!     ******************************************************************
!     *                                                                *
!     * File:          getDirVector.f90                                *
!     * Author:        Andre C. Marta                                  *
!     * Starting date: 10-25-2005                                      *
!     * Last modified: 10-26-2006                                      *
!     *                                                                *
!     ******************************************************************
!
SUBROUTINE GETDIRVECTOR_B(xb, yb, zb, alpha, alphab, beta, betab, xw, &
&  xwb, yw, ywb, zw, zwb)
  USE constants
  IMPLICIT NONE
!
!     ******************************************************************
!     *                                                                *
!     * Convert the angle of attack and side slip angle to wind axes.  *
!     * The components of the wind direction vector (xw,yw,zw) are     *
!     * computed given the direction angles in radians and the body    *
!     * direction by performing two rotations on the original          *
!     * direction vector:                                              *
!     *   1) Rotation about the yb-axis: alpha clockwise (CW)          *
!     *      (xb,yb,zb) -> (x1,y1,z1)                                  *
!     *                                                                *
!     *   2) Rotation about the z1-axis: beta counter-clockwise (CCW)  *
!     *      (x1,y1,z1) -> (xw,yw,zw)                                  *
!     *                                                                *
!     *    input arguments:                                            *
!     *       alpha    = angle of attack in radians                    *
!     *       beta     = side slip angle in radians                    *
!     *    output arguments:                                           *
!     *       xw,yw,zw = unit wind vector in body axes                 *
!     *                                                                *
!     ******************************************************************
!
!
!     Subroutine arguments.
!
  REAL(KIND=REALTYPE), INTENT(IN) :: xb, yb, zb
  REAL(KIND=REALTYPE) :: alpha, beta
  REAL(KIND=REALTYPE) :: alphab, betab
  REAL(KIND=REALTYPE) :: xw, yw, zw
  REAL(KIND=REALTYPE) :: xwb, ywb, zwb
!
!     Local variables.
!
  REAL(KIND=REALTYPE) :: rnorm, xbn, ybn, zbn, x1, y1, z1
  REAL(KIND=REALTYPE) :: xbnb, ybnb, zbnb, x1b, y1b, z1b
  REAL(KIND=REALTYPE) :: arg1
  REAL(KIND=REALTYPE) :: arg1b
  INTRINSIC SQRT
!
!     ******************************************************************
!     *                                                                *
!     * Begin execution.                                               *
!     *                                                                *
!     ******************************************************************
!
! Normalize the input vector.
  rnorm = SQRT(xb**2 + yb**2 + zb**2)
  xbn = xb/rnorm
  ybn = yb/rnorm
  zbn = zb/rnorm
!!$      ! Compute the wind direction vector.
!!$
!!$      ! 1) rotate alpha radians cw about y-axis
!!$      !    ( <=> rotate y-axis alpha radians ccw)
!!$
!!$      call vectorRotation(x1, y1, z1, 2, alpha, xbn, ybn, zbn)
!!$
!!$      ! 2) rotate beta radians ccw about z-axis
!!$      !    ( <=> rotate z-axis -beta radians ccw)
!!$
!!$      call vectorRotation(xw, yw, zw, 3, -beta, x1, y1, z1)
! Compute the wind direction vector.Aerosurf axes different!!
! 1) rotate alpha radians cw about z-axis
!    ( <=> rotate z-axis alpha radians ccw)
  arg1 = -alpha
  CALL VECTORROTATION(x1, y1, z1, 3, arg1, xbn, ybn, zbn)
  CALL PUSHREAL8(arg1)
! 2) rotate beta radians ccw about y-axis
!    ( <=> rotate z-axis -beta radians ccw)
  arg1 = -beta
  CALL VECTORROTATION_B(xw, xwb, yw, ywb, zw, zwb, 2, arg1, arg1b, x1, &
&                  x1b, y1, y1b, z1, z1b)
  CALL POPREAL8(arg1)
  betab = betab - arg1b
  CALL VECTORROTATION_B(x1, x1b, y1, y1b, z1, z1b, 3, arg1, arg1b, xbn, &
&                  xbnb, ybn, ybnb, zbn, zbnb)
  alphab = alphab - arg1b
END SUBROUTINE GETDIRVECTOR_B
