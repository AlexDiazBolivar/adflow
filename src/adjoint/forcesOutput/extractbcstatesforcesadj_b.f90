!        Generated by TAPENADE     (INRIA, Tropics team)
!  Tapenade - Version 2.2 (r1239) - Wed 28 Jun 2006 04:59:55 PM CEST
!  
!  Differentiation of extractbcstatesforcesadj in reverse (adjoint) mode:
!   gradient, with respect to input variables: padj wadj
!   of linear combination of output variables: padj0 padj1 padj2
!                padj padj3 wadj wadj0 wadj1 wadj2 wadj3
!
!      ******************************************************************
!      *                                                                *
!      * File:          extractBCStatesForcesAdj.f90                    *
!      * Author:        C.A.(Sandy) Mader                               *
!      * Starting date: 04-16-2008                                      *
!      * Last modified: 06-09-2008                                      *
!      *                                                                *
!      ******************************************************************
!
SUBROUTINE EXTRACTBCSTATESFORCESADJ_B(nn, wadj, wadjb, padj, padjb, &
&  wadj0, wadj0b, wadj1, wadj1b, wadj2, wadj2b, wadj3, wadj3b, padj0, &
&  padj0b, padj1, padj1b, padj2, padj2b, padj3, padj3b, rlvadj, revadj, &
&  rlvadj1, rlvadj2, revadj1, revadj2, icbeg, jcbeg, icend, jcend, &
&  secondhalo)
  USE bctypes
  USE blockpointers, ONLY : ie, ib, je, jb, ke, kb, nbocos, bcfaceid, &
&  bctype, bcdata
  USE flowvarrefstate
  IMPLICIT NONE
  INTEGER(KIND=INTTYPE) :: icbeg, icend, jcbeg, jcend
  INTEGER(KIND=INTTYPE), INTENT(IN) :: nn
  REAL(KIND=REALTYPE), DIMENSION(0:ib, 0:jb, 0:kb), INTENT(IN) :: padj
  REAL(KIND=REALTYPE) :: padj0(icbeg:icend, jcbeg:jcend), padj0b(icbeg:&
&  icend, jcbeg:jcend), padj1(icbeg:icend, jcbeg:jcend), padj1b(icbeg:&
&  icend, jcbeg:jcend)
  REAL(KIND=REALTYPE) :: padj2(icbeg:icend, jcbeg:jcend), padj2b(icbeg:&
&  icend, jcbeg:jcend), padj3(icbeg:icend, jcbeg:jcend), padj3b(icbeg:&
&  icend, jcbeg:jcend)
  REAL(KIND=REALTYPE) :: padjb(0:ib, 0:jb, 0:kb)
  REAL(KIND=REALTYPE) :: revadj1(icbeg:icend, jcbeg:jcend), revadj2(&
&  icbeg:icend, jcbeg:jcend)
  REAL(KIND=REALTYPE) :: revadj(0:ib, 0:jb, 0:kb), rlvadj(0:ib, 0:jb, 0:&
&  kb)
  REAL(KIND=REALTYPE) :: rlvadj1(icbeg:icend, jcbeg:jcend), rlvadj2(&
&  icbeg:icend, jcbeg:jcend)
  LOGICAL, INTENT(IN) :: secondhalo
  REAL(KIND=REALTYPE), DIMENSION(0:ib, 0:jb, 0:kb, nw), INTENT(IN) :: &
&  wadj
  REAL(KIND=REALTYPE) :: wadj0(icbeg:icend, jcbeg:jcend, nw), wadj0b(&
&  icbeg:icend, jcbeg:jcend, nw), wadj1(icbeg:icend, jcbeg:jcend, nw), &
&  wadj1b(icbeg:icend, jcbeg:jcend, nw)
  REAL(KIND=REALTYPE) :: wadj2(icbeg:icend, jcbeg:jcend, nw), wadj2b(&
&  icbeg:icend, jcbeg:jcend, nw), wadj3(icbeg:icend, jcbeg:jcend, nw), &
&  wadj3b(icbeg:icend, jcbeg:jcend, nw)
  REAL(KIND=REALTYPE) :: wadjb(0:ib, 0:jb, 0:kb, nw)
!      ******************************************************************
!      *                                                                *
!      * copyBCStatesAdj copies the states needed for the boundary      *
!      * condition treatment on a general face, such that the boundary  *
!      * routines are only implemented once instead of 6 times.         *
!      * This routine takes the place of setBCPointers in the orginal   *
!      * Code                                                           *
!      *                                                                *
!      ******************************************************************
!
!
!      Subroutine arguments.
!
!, offset
!
!      ******************************************************************
!      *                                                                *
!      * Begin execution                                                *
!      *                                                                *
!      ******************************************************************
!
! Set some pointers depending on the situation.
!print *,'selecting case,bcfacid',BCFaceID(nn)
  SELECT CASE  (bcfaceid(nn)) 
  CASE (imin) 
! At most the halo's of nearest neighbors enter the
! stencil. Make sure to limit properly.
!icBeg = max(jRBeg,jCell-1)
!icEnd = min(jREnd,jCell+1)
!jcBeg = max(kRBeg,kCell-1)
!jcEnd = min(kREnd,kCell+1)
! Other straightforward stuff.
!iOffset = jOffset
!jOffset = kOffset
!secondHalo = .true.
!if(iRBeg == iREnd) secondHalo = .false.
    IF (secondhalo) THEN
      padjb(3, icbeg:icend, jcbeg:jcend) = padjb(3, icbeg:icend, jcbeg:&
&        jcend) + padj3b(icbeg:icend, jcbeg:jcend)
      padjb(2, icbeg:icend, jcbeg:jcend) = padjb(2, icbeg:icend, jcbeg:&
&        jcend) + padj2b(icbeg:icend, jcbeg:jcend)
      padjb(1, icbeg:icend, jcbeg:jcend) = padjb(1, icbeg:icend, jcbeg:&
&        jcend) + padj1b(icbeg:icend, jcbeg:jcend)
      padjb(0, icbeg:icend, jcbeg:jcend) = padjb(0, icbeg:icend, jcbeg:&
&        jcend) + padj0b(icbeg:icend, jcbeg:jcend)
      wadjb(3, icbeg:icend, jcbeg:jcend, 1:nw) = wadjb(3, icbeg:icend, &
&        jcbeg:jcend, 1:nw) + wadj3b(icbeg:icend, jcbeg:jcend, 1:nw)
      wadjb(2, icbeg:icend, jcbeg:jcend, 1:nw) = wadjb(2, icbeg:icend, &
&        jcbeg:jcend, 1:nw) + wadj2b(icbeg:icend, jcbeg:jcend, 1:nw)
      wadjb(0, icbeg:icend, jcbeg:jcend, 1:nw) = wadjb(0, icbeg:icend, &
&        jcbeg:jcend, 1:nw) + wadj0b(icbeg:icend, jcbeg:jcend, 1:nw) + &
&        wadj1b(icbeg:icend, jcbeg:jcend, 1:nw)
  !    print *,'extract12',sum(wadjb),secondhalo
    ELSE
      padjb(2, icbeg:icend, jcbeg:jcend) = padjb(2, icbeg:icend, jcbeg:&
&        jcend) + padj3b(icbeg:icend, jcbeg:jcend)
      padjb(1, icbeg:icend, jcbeg:jcend) = padjb(1, icbeg:icend, jcbeg:&
&        jcend) + padj2b(icbeg:icend, jcbeg:jcend)
      padjb(0, icbeg:icend, jcbeg:jcend) = padjb(0, icbeg:icend, jcbeg:&
&        jcend) + padj1b(icbeg:icend, jcbeg:jcend)
      wadjb(2, icbeg:icend, jcbeg:jcend, 1:nw) = wadjb(2, icbeg:icend, &
&        jcbeg:jcend, 1:nw) + wadj3b(icbeg:icend, jcbeg:jcend, 1:nw)
      wadjb(1, icbeg:icend, jcbeg:jcend, 1:nw) = wadjb(1, icbeg:icend, &
&        jcbeg:jcend, 1:nw) + wadj2b(icbeg:icend, jcbeg:jcend, 1:nw)
      wadjb(0, icbeg:icend, jcbeg:jcend, 1:nw) = wadjb(0, icbeg:icend, &
&        jcbeg:jcend, 1:nw) + wadj1b(icbeg:icend, jcbeg:jcend, 1:nw)
   !   print *,'extract11',sum(wadjb),secondhalo
    END IF
  CASE (imax) 
!===========================================================
! At most the halo's of nearest neighbors enter the
! stencil. Make sure to limit properly.
!!$             icBeg = max(jRBeg,jCell-1)
!!$             icEnd = min(jREnd,jCell+1)
!!$             jcBeg = max(kRBeg,kCell-1)
!!$             jcEnd = min(kREnd,kCell+1)
!!$             
!!$             ! Other straightforward stuff.
!!$             
!!$             iOffset = jOffset
!!$             jOffset = kOffset
!!$             
!!$             secondHalo = .true.
!!$             if(iRBeg == iREnd) secondHalo = .false.
    IF (secondhalo) THEN
      padjb(ib-3, icbeg:icend, jcbeg:jcend) = padjb(ib-3, icbeg:icend, &
&        jcbeg:jcend) + padj3b(icbeg:icend, jcbeg:jcend)
      padjb(ib-2, icbeg:icend, jcbeg:jcend) = padjb(ib-2, icbeg:icend, &
&        jcbeg:jcend) + padj2b(icbeg:icend, jcbeg:jcend)
      padjb(ib-1, icbeg:icend, jcbeg:jcend) = padjb(ib-1, icbeg:icend, &
&        jcbeg:jcend) + padj1b(icbeg:icend, jcbeg:jcend)
      padjb(ib, icbeg:icend, jcbeg:jcend) = padjb(ib, icbeg:icend, jcbeg&
&        :jcend) + padj0b(icbeg:icend, jcbeg:jcend)
      wadjb(ib-3, icbeg:icend, jcbeg:jcend, 1:nw) = wadjb(ib-3, icbeg:&
&        icend, jcbeg:jcend, 1:nw) + wadj3b(icbeg:icend, jcbeg:jcend, 1:&
&        nw)
      wadjb(ib-2, icbeg:icend, jcbeg:jcend, 1:nw) = wadjb(ib-2, icbeg:&
&        icend, jcbeg:jcend, 1:nw) + wadj2b(icbeg:icend, jcbeg:jcend, 1:&
&        nw)
      wadjb(ib-1, icbeg:icend, jcbeg:jcend, 1:nw) = wadjb(ib-1, icbeg:&
&        icend, jcbeg:jcend, 1:nw) + wadj1b(icbeg:icend, jcbeg:jcend, 1:&
&        nw)
      wadjb(ib, icbeg:icend, jcbeg:jcend, 1:nw) = wadjb(ib, icbeg:icend&
&        , jcbeg:jcend, 1:nw) + wadj0b(icbeg:icend, jcbeg:jcend, 1:nw)
    !  print *,'extract10',sum(wadjb),secondhalo
    ELSE
      padjb(ib-2, icbeg:icend, jcbeg:jcend) = padjb(ib-2, icbeg:icend, &
&        jcbeg:jcend) + padj3b(icbeg:icend, jcbeg:jcend)
      padjb(ib-1, icbeg:icend, jcbeg:jcend) = padjb(ib-1, icbeg:icend, &
&        jcbeg:jcend) + padj2b(icbeg:icend, jcbeg:jcend)
      padjb(ib, icbeg:icend, jcbeg:jcend) = padjb(ib, icbeg:icend, jcbeg&
&        :jcend) + padj1b(icbeg:icend, jcbeg:jcend)
      wadjb(ib-2, icbeg:icend, jcbeg:jcend, 1:nw) = wadjb(ib-2, icbeg:&
&        icend, jcbeg:jcend, 1:nw) + wadj3b(icbeg:icend, jcbeg:jcend, 1:&
&        nw)
      wadjb(ib-1, icbeg:icend, jcbeg:jcend, 1:nw) = wadjb(ib-1, icbeg:&
&        icend, jcbeg:jcend, 1:nw) + wadj2b(icbeg:icend, jcbeg:jcend, 1:&
&        nw)
      wadjb(ib, icbeg:icend, jcbeg:jcend, 1:nw) = wadjb(ib, icbeg:icend&
&        , jcbeg:jcend, 1:nw) + wadj1b(icbeg:icend, jcbeg:jcend, 1:nw)
     ! print *,'extract9',sum(wadjb),secondhalo
    END IF
  CASE (jmin) 
!===========================================================
!print *,' in jmin'
! At most the halo's of nearest neighbors enter the
! stencil. Make sure to limit properly.
!!$             icBeg = max(iRBeg,iCell-1)
!!$             icEnd = min(iREnd,iCell+1)
!!$             jcBeg = max(kRBeg,kCell-1)
!!$             jcEnd = min(kREnd,kCell+1)
!!$             
!!$             ! Other straightforward stuff.
!!$             
!!$             jOffset = kOffset
!!$             
!!$             secondHalo = .true.
!!$             if(jRBeg == jREnd) secondHalo = .false.
    IF (secondhalo) THEN
      padjb(icbeg:icend, 3, jcbeg:jcend) = padjb(icbeg:icend, 3, jcbeg:&
&        jcend) + padj3b(icbeg:icend, jcbeg:jcend)
      padjb(icbeg:icend, 2, jcbeg:jcend) = padjb(icbeg:icend, 2, jcbeg:&
&        jcend) + padj2b(icbeg:icend, jcbeg:jcend)
      padjb(icbeg:icend, 1, jcbeg:jcend) = padjb(icbeg:icend, 1, jcbeg:&
&        jcend) + padj1b(icbeg:icend, jcbeg:jcend)
      padjb(icbeg:icend, 0, jcbeg:jcend) = padjb(icbeg:icend, 0, jcbeg:&
&        jcend) + padj0b(icbeg:icend, jcbeg:jcend)
      wadjb(icbeg:icend, 3, jcbeg:jcend, 1:nw) = wadjb(icbeg:icend, 3, &
&        jcbeg:jcend, 1:nw) + wadj3b(icbeg:icend, jcbeg:jcend, 1:nw)
      wadjb(icbeg:icend, 2, jcbeg:jcend, 1:nw) = wadjb(icbeg:icend, 2, &
&        jcbeg:jcend, 1:nw) + wadj2b(icbeg:icend, jcbeg:jcend, 1:nw)
      wadjb(icbeg:icend, 1, jcbeg:jcend, 1:nw) = wadjb(icbeg:icend, 1, &
&        jcbeg:jcend, 1:nw) + wadj1b(icbeg:icend, jcbeg:jcend, 1:nw)
      wadjb(icbeg:icend, 0, jcbeg:jcend, 1:nw) = wadjb(icbeg:icend, 0, &
&        jcbeg:jcend, 1:nw) + wadj0b(icbeg:icend, jcbeg:jcend, 1:nw)
      !print *,'extract8',sum(wadjb),secondhalo
    ELSE
      padjb(icbeg:icend, 2, jcbeg:jcend) = padjb(icbeg:icend, 2, jcbeg:&
&        jcend) + padj3b(icbeg:icend, jcbeg:jcend)
      padjb(icbeg:icend, 1, jcbeg:jcend) = padjb(icbeg:icend, 1, jcbeg:&
&        jcend) + padj2b(icbeg:icend, jcbeg:jcend)
      padjb(icbeg:icend, 0, jcbeg:jcend) = padjb(icbeg:icend, 0, jcbeg:&
&        jcend) + padj1b(icbeg:icend, jcbeg:jcend)
      wadjb(icbeg:icend, 2, jcbeg:jcend, 1:nw) = wadjb(icbeg:icend, 2, &
&        jcbeg:jcend, 1:nw) + wadj3b(icbeg:icend, jcbeg:jcend, 1:nw)
      wadjb(icbeg:icend, 1, jcbeg:jcend, 1:nw) = wadjb(icbeg:icend, 1, &
&        jcbeg:jcend, 1:nw) + wadj2b(icbeg:icend, jcbeg:jcend, 1:nw)
      wadjb(icbeg:icend, 0, jcbeg:jcend, 1:nw) = wadjb(icbeg:icend, 0, &
&        jcbeg:jcend, 1:nw) + wadj1b(icbeg:icend, jcbeg:jcend, 1:nw)
      !print *,'extract7',sum(wadjb),secondhalo
    END IF
  CASE (jmax) 
!===========================================================
! At most the halo's of nearest neighbors enter the
! stencil. Make sure to limit properly.
!!$             icBeg = max(iRBeg,iCell-1)
!!$             icEnd = min(iREnd,iCell+1)
!!$             jcBeg = max(kRBeg,kCell-1)
!!$             jcEnd = min(kREnd,kCell+1)
!!$             
!!$             ! Other straightforward stuff.
!!$             
!!$             jOffset = kOffset
!!$             
!!$             secondHalo = .true.
!!$             if(jRBeg == jREnd) secondHalo = .false.
    IF (secondhalo) THEN
      padjb(icbeg:icend, jb-3, jcbeg:jcend) = padjb(icbeg:icend, jb-3, &
&        jcbeg:jcend) + padj3b(icbeg:icend, jcbeg:jcend)
      padjb(icbeg:icend, jb-2, jcbeg:jcend) = padjb(icbeg:icend, jb-2, &
&        jcbeg:jcend) + padj2b(icbeg:icend, jcbeg:jcend)
      padjb(icbeg:icend, jb-1, jcbeg:jcend) = padjb(icbeg:icend, jb-1, &
&        jcbeg:jcend) + padj1b(icbeg:icend, jcbeg:jcend)
      padjb(icbeg:icend, jb, jcbeg:jcend) = padjb(icbeg:icend, jb, jcbeg&
&        :jcend) + padj0b(icbeg:icend, jcbeg:jcend)
      wadjb(icbeg:icend, jb-3, jcbeg:jcend, 1:nw) = wadjb(icbeg:icend, &
&        jb-3, jcbeg:jcend, 1:nw) + wadj3b(icbeg:icend, jcbeg:jcend, 1:&
&        nw)
      wadjb(icbeg:icend, jb-2, jcbeg:jcend, 1:nw) = wadjb(icbeg:icend, &
&        jb-2, jcbeg:jcend, 1:nw) + wadj2b(icbeg:icend, jcbeg:jcend, 1:&
&        nw)
      wadjb(icbeg:icend, jb-1, jcbeg:jcend, 1:nw) = wadjb(icbeg:icend, &
&        jb-1, jcbeg:jcend, 1:nw) + wadj1b(icbeg:icend, jcbeg:jcend, 1:&
&        nw)
      wadjb(icbeg:icend, jb, jcbeg:jcend, 1:nw) = wadjb(icbeg:icend, jb&
&        , jcbeg:jcend, 1:nw) + wadj0b(icbeg:icend, jcbeg:jcend, 1:nw)
      !print *,'extract6',sum(wadjb),secondhalo
    ELSE
      padjb(icbeg:icend, jb-2, jcbeg:jcend) = padjb(icbeg:icend, jb-2, &
&        jcbeg:jcend) + padj3b(icbeg:icend, jcbeg:jcend)
      padjb(icbeg:icend, jb-1, jcbeg:jcend) = padjb(icbeg:icend, jb-1, &
&        jcbeg:jcend) + padj2b(icbeg:icend, jcbeg:jcend)
      padjb(icbeg:icend, jb, jcbeg:jcend) = padjb(icbeg:icend, jb, jcbeg&
&        :jcend) + padj1b(icbeg:icend, jcbeg:jcend)
      wadjb(icbeg:icend, jb-2, jcbeg:jcend, 1:nw) = wadjb(icbeg:icend, &
&        jb-2, jcbeg:jcend, 1:nw) + wadj3b(icbeg:icend, jcbeg:jcend, 1:&
&        nw)
      wadjb(icbeg:icend, jb-1, jcbeg:jcend, 1:nw) = wadjb(icbeg:icend, &
&        jb-1, jcbeg:jcend, 1:nw) + wadj2b(icbeg:icend, jcbeg:jcend, 1:&
&        nw)
      wadjb(icbeg:icend, jb, jcbeg:jcend, 1:nw) = wadjb(icbeg:icend, jb&
&        , jcbeg:jcend, 1:nw) + wadj1b(icbeg:icend, jcbeg:jcend, 1:nw)
      !print *,'extract5',sum(wadjb),secondhalo
    END IF
  CASE (kmin) 
!===========================================================
! At most the halo's of nearest neighbors enter the
! stencil. Make sure to limit properly.
!!$             icBeg = max(iRBeg,iCell-1)
!!$             icEnd = min(iREnd,iCell+1)
!!$             jcBeg = max(jRBeg,jCell-1)
!!$             jcEnd = min(jREnd,jCell+1)
!!$             
!!$             ! Other straightforward stuff.
!!$             
!!$             secondHalo = .true.
!!$             if(kRBeg == kREnd) secondHalo = .false.
    IF (secondhalo) THEN
      padjb(icbeg:icend, jcbeg:jcend, 3) = padjb(icbeg:icend, jcbeg:&
&        jcend, 3) + padj3b(icbeg:icend, jcbeg:jcend)
      padjb(icbeg:icend, jcbeg:jcend, 2) = padjb(icbeg:icend, jcbeg:&
&        jcend, 2) + padj2b(icbeg:icend, jcbeg:jcend)
      padjb(icbeg:icend, jcbeg:jcend, 1) = padjb(icbeg:icend, jcbeg:&
&        jcend, 1) + padj1b(icbeg:icend, jcbeg:jcend)
      padjb(icbeg:icend, jcbeg:jcend, 0) = padjb(icbeg:icend, jcbeg:&
&        jcend, 0) + padj0b(icbeg:icend, jcbeg:jcend)
      wadjb(icbeg:icend, jcbeg:jcend, 3, 1:nw) = wadjb(icbeg:icend, &
&        jcbeg:jcend, 3, 1:nw) + wadj3b(icbeg:icend, jcbeg:jcend, 1:nw)
      wadjb(icbeg:icend, jcbeg:jcend, 2, 1:nw) = wadjb(icbeg:icend, &
&        jcbeg:jcend, 2, 1:nw) + wadj2b(icbeg:icend, jcbeg:jcend, 1:nw)
      wadjb(icbeg:icend, jcbeg:jcend, 1, 1:nw) = wadjb(icbeg:icend, &
&        jcbeg:jcend, 1, 1:nw) + wadj1b(icbeg:icend, jcbeg:jcend, 1:nw)
      wadjb(icbeg:icend, jcbeg:jcend, 0, 1:nw) = wadjb(icbeg:icend, &
&        jcbeg:jcend, 0, 1:nw) + wadj0b(icbeg:icend, jcbeg:jcend, 1:nw)
      !print *,'extract4',sum(wadjb),secondhalo,sum(wadjb(icbeg:icend, &
!&        jcbeg:jcend, :, 1:nw)),sum(wadj3b(icbeg:icend, jcbeg:jcend, 1:nw)),sum(wadj2b(icbeg:icend, jcbeg:jcend, 1:nw)),sum(wadj1b(icbeg:icend, jcbeg:jcend, 1:nw)),sum(wadj0b(icbeg:icend, jcbeg:jcend, 1:nw))
    ELSE
      padjb(icbeg:icend, jcbeg:jcend, 2) = padjb(icbeg:icend, jcbeg:&
&        jcend, 2) + padj3b(icbeg:icend, jcbeg:jcend)
      padjb(icbeg:icend, jcbeg:jcend, 1) = padjb(icbeg:icend, jcbeg:&
&        jcend, 1) + padj2b(icbeg:icend, jcbeg:jcend)
      padjb(icbeg:icend, jcbeg:jcend, 0) = padjb(icbeg:icend, jcbeg:&
&        jcend, 0) + padj1b(icbeg:icend, jcbeg:jcend)
      wadjb(icbeg:icend, jcbeg:jcend, 2, 1:nw) = wadjb(icbeg:icend, &
&        jcbeg:jcend, 2, 1:nw) + wadj3b(icbeg:icend, jcbeg:jcend, 1:nw)
      wadjb(icbeg:icend, jcbeg:jcend, 1, 1:nw) = wadjb(icbeg:icend, &
&        jcbeg:jcend, 1, 1:nw) + wadj2b(icbeg:icend, jcbeg:jcend, 1:nw)
      wadjb(icbeg:icend, jcbeg:jcend, 0, 1:nw) = wadjb(icbeg:icend, &
&        jcbeg:jcend, 0, 1:nw) + wadj1b(icbeg:icend, jcbeg:jcend, 1:nw)
 !     print *,'extract3',sum(wadjb),secondhalo
    END IF
  CASE (kmax) 
!===========================================================
! At most the halo's of nearest neighbors enter the
! stencil. Make sure to limit properly.
!!$             icBeg = max(iRBeg,iCell-1)
!!$             icEnd = min(iREnd,iCell+1)
!!$             jcBeg = max(jRBeg,jCell-1)
!!$             jcEnd = min(jREnd,jCell+1)
!!$             
!!$             ! Other straightforward stuff.
!!$             
!!$             secondHalo = .true.
!!$             if(kRBeg == kREnd) secondHalo = .false.
    IF (secondhalo) THEN
      padjb(icbeg:icend, jcbeg:jcend, kb-3) = padjb(icbeg:icend, jcbeg:&
&        jcend, kb-3) + padj3b(icbeg:icend, jcbeg:jcend)
      padjb(icbeg:icend, jcbeg:jcend, kb-2) = padjb(icbeg:icend, jcbeg:&
&        jcend, kb-2) + padj2b(icbeg:icend, jcbeg:jcend)
      padjb(icbeg:icend, jcbeg:jcend, kb-1) = padjb(icbeg:icend, jcbeg:&
&        jcend, kb-1) + padj1b(icbeg:icend, jcbeg:jcend)
      padjb(icbeg:icend, jcbeg:jcend, kb) = padjb(icbeg:icend, jcbeg:&
&        jcend, kb) + padj0b(icbeg:icend, jcbeg:jcend)
      wadjb(icbeg:icend, jcbeg:jcend, kb-3, 1:nw) = wadjb(icbeg:icend, &
&        jcbeg:jcend, kb-3, 1:nw) + wadj3b(icbeg:icend, jcbeg:jcend, 1:&
&        nw)
      wadjb(icbeg:icend, jcbeg:jcend, kb-2, 1:nw) = wadjb(icbeg:icend, &
&        jcbeg:jcend, kb-2, 1:nw) + wadj2b(icbeg:icend, jcbeg:jcend, 1:&
&        nw)
      wadjb(icbeg:icend, jcbeg:jcend, kb-1, 1:nw) = wadjb(icbeg:icend, &
&        jcbeg:jcend, kb-1, 1:nw) + wadj1b(icbeg:icend, jcbeg:jcend, 1:&
&        nw)
      wadjb(icbeg:icend, jcbeg:jcend, kb, 1:nw) = wadjb(icbeg:icend, &
&        jcbeg:jcend, kb, 1:nw) + wadj0b(icbeg:icend, jcbeg:jcend, 1:nw)
  !    print *,'extract2',sum(wadjb),secondhalo
    ELSE
      padjb(icbeg:icend, jcbeg:jcend, kb-2) = padjb(icbeg:icend, jcbeg:&
&        jcend, kb-2) + padj3b(icbeg:icend, jcbeg:jcend)
      padjb(icbeg:icend, jcbeg:jcend, kb-1) = padjb(icbeg:icend, jcbeg:&
&        jcend, kb-1) + padj2b(icbeg:icend, jcbeg:jcend)
      padjb(icbeg:icend, jcbeg:jcend, kb) = padjb(icbeg:icend, jcbeg:&
&        jcend, kb) + padj1b(icbeg:icend, jcbeg:jcend)
      wadjb(icbeg:icend, jcbeg:jcend, kb-2, 1:nw) = wadjb(icbeg:icend, &
&        jcbeg:jcend, kb-2, 1:nw) + wadj3b(icbeg:icend, jcbeg:jcend, 1:&
&        nw)
      wadjb(icbeg:icend, jcbeg:jcend, kb-1, 1:nw) = wadjb(icbeg:icend, &
&        jcbeg:jcend, kb-1, 1:nw) + wadj2b(icbeg:icend, jcbeg:jcend, 1:&
&        nw)
      wadjb(icbeg:icend, jcbeg:jcend, kb, 1:nw) = wadjb(icbeg:icend, &
&        jcbeg:jcend, kb, 1:nw) + wadj1b(icbeg:icend, jcbeg:jcend, 1:nw)
   !   print *,'extract1',sum(wadjb),secondhalo
    END IF
  END SELECT
END SUBROUTINE EXTRACTBCSTATESFORCESADJ_B
