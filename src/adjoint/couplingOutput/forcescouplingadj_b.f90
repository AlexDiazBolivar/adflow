!        Generated by TAPENADE     (INRIA, Tropics team)
!  Tapenade 3.3 (r3163) - 09/25/2009 09:03
!
!  Differentiation of forcescouplingadj in reverse (adjoint) mode:
!   gradient, with respect to input variables: padj normadj
!   of linear combination of output variables: force
!
!      ******************************************************************
!      *                                                                *
!      * File:          forcesCouplingAdj.f90                           *
!      * Author:        Edwin van der Weide,C.A.(Sandy) Mader           *
!      * Starting date: 08-17-2008                                      *
!      * Last modified: 08-17-2008                                      *
!      *                                                                *
!      ******************************************************************
!
SUBROUTINE FORCESCOUPLINGADJ_B(padj, padjb, pts, normadj, normadjb, &
&  force, forceb, fact, ibeg, iend, jbeg, jend, inode, jnode)
  USE FLOWVARREFSTATE
  IMPLICIT NONE
!
! Subroutine Arguments
  REAL(kind=realtype), INTENT(IN) :: padj(3, 2, 2)
  REAL(kind=realtype) :: padjb(3, 2, 2)
  REAL(kind=realtype), INTENT(IN) :: pts(3, 3, 3)
  REAL(kind=realtype), INTENT(IN) :: normadj(3, 2, 2)
  REAL(kind=realtype) :: normadjb(3, 2, 2)
  REAL(kind=realtype) :: force(3)
  REAL(kind=realtype) :: forceb(3)
  REAL(kind=realtype), INTENT(IN) :: fact
  INTEGER(kind=inttype), INTENT(IN) :: ibeg, iend, jbeg, jend, inode, &
&  jnode
! Local Variables
  INTEGER(kind=inttype) :: i, j
  REAL(kind=realtype) :: pp, scaledim
  REAL(kind=realtype) :: ppb
  INTEGER :: branch
  scaledim = pref
! Force is the contribution of each of 4 cells
  DO j=1,2
    DO i=1,2
      IF (.NOT.(((inode + i - 2 .LT. ibeg .OR. inode + i - 1 .GT. iend) &
&          .OR. jnode + j - 2 .LT. jbeg) .OR. jnode + j - 1 .GT. jend)) &
&      THEN
        CALL PUSHREAL8ARRAY(pp, realtype/8)
! Calculate the Pressure
        pp = half*(padj(1, i, j)+padj(2, i, j)) - pinf
        pp = fourth*fact*scaledim*pp
        CALL PUSHINTEGER4(2)
      ELSE
        CALL PUSHINTEGER4(1)
      END IF
    END DO
  END DO
  padjb = 0.0
  normadjb = 0.0
  DO j=2,1,-1
    DO i=2,1,-1
      CALL POPINTEGER4(branch)
      IF (.NOT.branch .LT. 2) THEN
        ppb = SUM(normadj(:, i, j)*forceb(:))
        normadjb(:, i, j) = normadjb(:, i, j) + pp*forceb(:)
        ppb = fourth*fact*scaledim*ppb
        CALL POPREAL8ARRAY(pp, realtype/8)
        padjb(1, i, j) = padjb(1, i, j) + half*ppb
        padjb(2, i, j) = padjb(2, i, j) + half*ppb
      END IF
    END DO
  END DO
END SUBROUTINE FORCESCOUPLINGADJ_B
