!        Generated by TAPENADE     (INRIA, Tropics team)
!  Tapenade 2.2.4 (r2308) - 03/04/2008 10:03
!  
!  Differentiation of setflowinfinitystateadj in reverse (adjoint) mode:
!   gradient, with respect to input variables: uinfadj veldirfreestreamadj
!   of linear combination of output variables: winfadj pinfcorradj
!
!      ******************************************************************
!      *                                                                *
!      * File:          setFlowInfinityStateAdj.f90                     *
!      * Author:        Edwin van der Weide, Georgi Kalitzin            *
!      *                C.A.(Sandy) Mader
!      * Starting date: 02-21-2003                                      *
!      * Last modified: 05-14-2008                                      *
!      *                                                                *
!      ******************************************************************
!
SUBROUTINE SETFLOWINFINITYSTATEADJ_B(veldirfreestreamadj, &
&  veldirfreestreamadjb, liftdirectionadj, dragdirectionadj, machadj, &
&  machcoefadj, uinfadj, uinfadjb, winfadj, winfadjb, prefadj, rhorefadj&
&  , pinfdimadj, rhoinfdimadj, rhoinfadj, pinfadj, murefadj, timerefadj&
&  , pinfcorradj, pinfcorradjb)
  USE constants
  USE flowvarrefstate
  IMPLICIT NONE
!
!      ******************************************************************
!      *                                                                *
!      * setFlowInfinityState sets the free stream state vector of      *
!      * the flow variables. If nothing is specified for each of the    *
!      * farfield boundaries, these values will be taken to define the  *
!      * free stream.                                                   *
!      *                                                                *
!      ******************************************************************
!
!
!      subroutine Variables
!
  REAL(KIND=REALTYPE), DIMENSION(3) :: veldirfreestreamadj
  REAL(KIND=REALTYPE), DIMENSION(3) :: veldirfreestreamadjb
  REAL(KIND=REALTYPE), DIMENSION(3), INTENT(INOUT) :: liftdirectionadj
  REAL(KIND=REALTYPE), DIMENSION(3), INTENT(INOUT) :: dragdirectionadj
  REAL(KIND=REALTYPE) :: machadj, machcoefadj, uinfadj, pinfcorradj
  REAL(KIND=REALTYPE) :: uinfadjb, pinfcorradjb
  REAL(KIND=REALTYPE) :: prefadj, rhorefadj
  REAL(KIND=REALTYPE) :: pinfdimadj, rhoinfdimadj
  REAL(KIND=REALTYPE) :: rhoinfadj, pinfadj
  REAL(KIND=REALTYPE) :: rhoinfadjb
  REAL(KIND=REALTYPE) :: murefadj, timerefadj
  REAL(KIND=REALTYPE), DIMENSION(nw) :: winfadj
  REAL(KIND=REALTYPE), DIMENSION(nw) :: winfadjb
!
!      Local variables
!
  INTEGER :: ierr
  REAL(KIND=REALTYPE) :: nuinf, ktmp, uinf2, vtmp, wtmp
  REAL(KIND=REALTYPE) :: ktmpb, vtmpb, wtmpb
!
!      Function definition
!
  REAL(KIND=REALTYPE) :: sanuknowneddyratio
  INTEGER :: branch
!
!      ******************************************************************
!      *                                                                *
!      * Begin execution                                                *
!      *                                                                *
!      ******************************************************************
!
! Compute the velocity squared based on MachCoef;
! needed for the initialization of the turbulent energy,
! especially for moving geometries.
!!$       ! Allocate the memory for wInf.
!!$
!!$       allocate(wInf(nw), stat=ierr)
!!$       if(ierr /= 0)                             &
!!$         call terminate("setFlowReferenceState", &
!!$                        "Memory allocation failure for wInf")
! Set the reference value of the flow variables, except the total
! energy. This will be computed at the end of this routine.
  winfadj(irho) = rhoinfadj
  winfadj(ivx) = uinfadj*veldirfreestreamadj(1)
  winfadj(ivy) = uinfadj*veldirfreestreamadj(2)
  winfadj(ivz) = uinfadj*veldirfreestreamadj(3)
!!$       ! Set the turbulent variables if transport variables are
!!$       ! to be solved.
!!$
!!$       if(equations == RANSEquations) then
!!$
!!$         nuInf  = muInf/rhoInf
!!$
!!$         select case(turbModel)
!!$
!!$           case (spalartAllmaras, spalartAllmarasEdwards)
!!$
!!$             wInf(itu1) = saNuKnownEddyRatio(eddyVisInfRatio, nuInf)
!!$         !   wInf(itu1) = 1.341946*nuInf   ! eddyVis = 0.009*lamVis
!!$
!!$           !=============================================================
!!$
!!$           case (komegaWilcox, komegaModified, menterSST)
!!$
!!$             wInf(itu1) = 1.5_realType*uInf2*turbIntensityInf**2
!!$             wInf(itu2) = wInf(itu1)/(eddyVisInfRatio*nuInf)
!!$
!!$           !=============================================================
!!$
!!$           case (ktau)
!!$
!!$             wInf(itu1) = 1.5_realType*uInf2*turbIntensityInf**2
!!$             wInf(itu2) = eddyVisInfRatio*nuInf/wInf(itu1)
!!$
!!$           !=============================================================
!!$
!!$           case (v2f)
!!$
!!$             wInf(itu1) = 1.5_realType*uInf2*turbIntensityInf**2
!!$             wInf(itu2) = 0.09_realType*wInf(itu1)**2 &
!!$                        / (eddyVisInfRatio*nuInf)
!!$             wInf(itu3) = 0.666666_realType*wInf(itu1)
!!$             wInf(itu4) = 0.0_realType
!!$
!!$         end select
!!$
!!$       endif
! Set the value of pInfCorr. In case a k-equation is present
! add 2/3 times rho*k.
  pinfcorradj = pinf
  IF (kpresent) THEN
    pinfcorradj = pinf + two*third*rhoinfadj*winfadj(itu1)
    CALL PUSHINTEGER4(1)
  ELSE
    CALL PUSHINTEGER4(0)
  END IF
! Compute the free stream total energy.
!zero
  ktmp = 0.0
!      if( kPresent ) ktmp = wInfAdj(itu1)
  vtmp = 0.0
  wtmp = 0.0
!       call etotArrayAdj(rhoInf, uInfAdj, zero, zero, pInfCorr, ktmp, &
!                       wInfAdj(irhoE), kPresent, 1_intType)
  CALL ETOTARRAYADJ_B(rhoinfadj, rhoinfadjb, uinfadj, uinfadjb, vtmp, &
&                vtmpb, wtmp, wtmpb, pinfcorradj, pinfcorradjb, ktmp, &
&                ktmpb, winfadj(irhoe), winfadjb(irhoe), kpresent, 1)
  CALL POPINTEGER4(branch)
  IF (.NOT.branch .LT. 1) winfadjb(itu1) = winfadjb(itu1) + two*third*&
&      rhoinfadj*pinfcorradjb
  veldirfreestreamadjb(:) = 0.0
  uinfadjb = uinfadjb + veldirfreestreamadj(3)*winfadjb(ivz)
  veldirfreestreamadjb(3) = uinfadj*winfadjb(ivz)
  winfadjb(ivz) = 0.0
  uinfadjb = uinfadjb + veldirfreestreamadj(2)*winfadjb(ivy)
  veldirfreestreamadjb(2) = veldirfreestreamadjb(2) + uinfadj*winfadjb(&
&    ivy)
  winfadjb(ivy) = 0.0
  uinfadjb = uinfadjb + veldirfreestreamadj(1)*winfadjb(ivx)
  veldirfreestreamadjb(1) = veldirfreestreamadjb(1) + uinfadj*winfadjb(&
&    ivx)
END SUBROUTINE SETFLOWINFINITYSTATEADJ_B
