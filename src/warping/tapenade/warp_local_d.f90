!        Generated by TAPENADE     (INRIA, Tropics team)
!  Tapenade 2.2.4 (r2308) - 03/04/2008 10:03
!  
!  Differentiation of warp_local in forward (tangent) mode:
!   variations  of output variables: xyznew
!   with respect to input variables: xyznew
!
! ***********************************
! *  File: warp_local.f90
! *  Author: C.A.(Sandy) Mader
! *  Started: 12-07-2008
! *  Modified: 12-07-2008
! ***********************************
SUBROUTINE WARP_LOCAL_D(xyznew, xyznewd, xyz0, ifaceptb, iedgeptb, imax&
&  , jmax, kmax)
  USE blockpointers_d
  IMPLICIT NONE
  INTEGER(KIND=INTTYPE) :: imax, jmax, kmax
! Subroutine Arguments
  REAL(KIND=REALTYPE), DIMENSION(3, 0:imax+1, 0:jmax+1, 0:kmax+1) :: &
&  xyznew, xyz0
  REAL(KIND=REALTYPE), DIMENSION(3, 0:imax+1, 0:jmax+1, 0:kmax+1) :: &
&  xyznewd
  INTEGER(KIND=INTTYPE), DIMENSION(6) :: ifaceptb
  INTEGER(KIND=INTTYPE), DIMENSION(12) :: iedgeptb
! Local Variables
  REAL(KIND=REALTYPE), DIMENSION(:, :, :, :, :), ALLOCATABLE :: dfacei, &
&  dfacej, dfacek
  REAL(KIND=REALTYPE), DIMENSION(:, :, :, :), ALLOCATABLE :: s0
  REAL :: result1
  REAL :: result2
  INTRINSIC MAXVAL
  ALLOCATE(dfacei(3, 1:jmax, 1:kmax, 2, 4))
  ALLOCATE(dfacej(3, 1:imax, 1:kmax, 2, 4))
  ALLOCATE(dfacek(3, 1:imax, 1:jmax, 2, 4))
  dfacei = 0.0
  dfacej = 0.0
  dfacek = 0.0
  dfacei(1, 1:jmax, 1:kmax, 1, 1) = xyznew(1, 1, 1:jmax, 1:kmax) - xyz0(&
&    1, 1, 1:jmax, 1:kmax)
  dfacei(2, 1:jmax, 1:kmax, 1, 1) = xyznew(2, 1, 1:jmax, 1:kmax) - xyz0(&
&    2, 1, 1:jmax, 1:kmax)
  dfacei(3, 1:jmax, 1:kmax, 1, 1) = xyznew(3, 1, 1:jmax, 1:kmax) - xyz0(&
&    3, 1, 1:jmax, 1:kmax)
  dfacei(1, 1:jmax, 1:kmax, 2, 1) = xyznew(1, imax, 1:jmax, 1:kmax) - &
&    xyz0(1, imax, 1:jmax, 1:kmax)
  dfacei(2, 1:jmax, 1:kmax, 2, 1) = xyznew(2, imax, 1:jmax, 1:kmax) - &
&    xyz0(2, imax, 1:jmax, 1:kmax)
  dfacei(3, 1:jmax, 1:kmax, 2, 1) = xyznew(3, imax, 1:jmax, 1:kmax) - &
&    xyz0(3, imax, 1:jmax, 1:kmax)
  dfacej(1, 1:imax, 1:kmax, 1, 1) = xyznew(1, 1:imax, 1, 1:kmax) - xyz0(&
&    1, 1:imax, 1, 1:kmax)
  dfacej(2, 1:imax, 1:kmax, 1, 1) = xyznew(2, 1:imax, 1, 1:kmax) - xyz0(&
&    2, 1:imax, 1, 1:kmax)
  dfacej(3, 1:imax, 1:kmax, 1, 1) = xyznew(3, 1:imax, 1, 1:kmax) - xyz0(&
&    3, 1:imax, 1, 1:kmax)
  dfacej(1, 1:imax, 1:kmax, 2, 1) = xyznew(1, 1:imax, jmax, 1:kmax) - &
&    xyz0(1, 1:imax, jmax, 1:kmax)
  dfacej(2, 1:imax, 1:kmax, 2, 1) = xyznew(2, 1:imax, jmax, 1:kmax) - &
&    xyz0(2, 1:imax, jmax, 1:kmax)
  dfacej(3, 1:imax, 1:kmax, 2, 1) = xyznew(3, 1:imax, jmax, 1:kmax) - &
&    xyz0(3, 1:imax, jmax, 1:kmax)
  dfacek(1, 1:imax, 1:jmax, 1, 1) = xyznew(1, 1:imax, 1:jmax, 1) - xyz0(&
&    1, 1:imax, 1:jmax, 1)
  dfacek(2, 1:imax, 1:jmax, 1, 1) = xyznew(2, 1:imax, 1:jmax, 1) - xyz0(&
&    2, 1:imax, 1:jmax, 1)
  dfacek(3, 1:imax, 1:jmax, 1, 1) = xyznew(3, 1:imax, 1:jmax, 1) - xyz0(&
&    3, 1:imax, 1:jmax, 1)
  dfacek(1, 1:imax, 1:jmax, 2, 1) = xyznew(1, 1:imax, 1:jmax, kmax) - &
&    xyz0(1, 1:imax, 1:jmax, kmax)
  dfacek(2, 1:imax, 1:jmax, 2, 1) = xyznew(2, 1:imax, 1:jmax, kmax) - &
&    xyz0(2, 1:imax, 1:jmax, kmax)
  dfacek(3, 1:imax, 1:jmax, 2, 1) = xyznew(3, 1:imax, 1:jmax, kmax) - &
&    xyz0(3, 1:imax, 1:jmax, kmax)
  ALLOCATE(s0(3, 0:imax+1, 0:jmax+1, 0:kmax+1))
  s0 = 0.0
! CALL WARPBLK FOR THE CURRENT BLOCK IF ANY OF THE FACES OR EDGES IN THAT 
! BLOCK ARE IMPLICITLY OR EXPLICITLY PERTURBED
  result1 = MAXVAL(ifaceptb(1:6))
  result2 = MAXVAL(iedgeptb(1:12))
  IF (result1 .GE. 1 .OR. result2 .GE. 1) CALL WARPBLK_D(ifaceptb(1:6), &
&                                                   iedgeptb(1:12), -3, &
&                                                   0, 1, imax, jmax, &
&                                                   kmax, xyz0, s0, &
&                                                   dfacei, dfacej, &
&                                                   dfacek, xyznew, &
&                                                   xyznewd)
  DEALLOCATE(s0)
  DEALLOCATE(dfacei)
  DEALLOCATE(dfacej)
  DEALLOCATE(dfacek)
END SUBROUTINE WARP_LOCAL_D
